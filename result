1.
-------------------
using System;

class Program
{
    static void Main(string[] args)
    {
        for (int i = 0; i < 1000; i++)
        {
            using (var resource = new ResourceHolder())
            {
                resource.DoWork();
            } // Dispose خودکار اینجا اجرا میشه
        }

        Console.WriteLine("Finish");
    }
}

public class ResourceHolder : IDisposable
{
    private bool _disposed;
    // فرض محتوای unmanaged
    // private SafeHandle _safeHandle = new SafeFileHandle(...);

    public void DoWork()
    {
        if (_disposed) 
            throw new ObjectDisposedException(nameof(ResourceHolder));
        
        // عملیات...
    }

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this); // نیاز به finalize بعد dispose نیست
    }

    protected virtual void Dispose(bool disposing)
    {
        if (!_disposed)
        {
            if (disposing)
            {
                // آزادسازی منابع managed
                // _safeHandle?.Dispose();
                // سایر فیلدهای IDisposable
            }

           
            _disposed = true;
        }
    }

    ~ResourceHolder()
    {
        Dispose(false); 
    }
}

------------------------------------------

